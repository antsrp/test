# Тестовое задание для backend-разработчика (Balance service)

## Параметры запуска

Формирование контейнеров выполняется с помощью команд
```
docker-compose build --no-cache
docker-compose up
```
или соответствующий ему аналог в makefile (make docker-start)
Для запуска тестов использовать команду
```
go test -v ./...
```
или соответствующий ему аналог в makefile (make test)  
Подразумевается использование тестов на пустой базе, их запуск обнуляет имеющиеся данные в таблицах.  
Swagger: http://localhost:5000/swagger/index.html  

## Доступные запросы

### POST /api/v1/add-balance [Добавление суммы на баланс пользователя]
Параметры передаются в body:   
{  
  "balance": 200,  
  "comment": "some description of comment",  
  "time": "2020-03-21T12:00:00Z",  
  "user_id": 1  
}  
user_id - уникальный идентификатор пользователя  
balance - сумма, на которую необходимо увеличить баланс  
comment - комментарий, сопровождающий операцию пополнения  
time - время пополнения в формате RFC3339  

### GET /api/v1/get-balance?user_id="id" [Получение баланса пользователя]
query параметр user_id - уникальный идентификатор пользователя  

### POST /api/v1/reserve [Метод резервирования средств]
Параметры передаются в body:  
{  
  "comment": "des",  
  "cost": 100,  
  "order_id": 10,  
  "service_id": 3,  
  "user_id": 4  
}  
user_id - уникальный идентификатор пользователя  
cost - стоимость операции  
comment - комментарий, сопровождающий операцию резервирования  
order_id - уникальный идентификатор заказа  
service_id - уникальный идентификатор услуги  

Операция выполнима в том случае, если стоимость операции не превосходит суммы баланса пользователя и уже зарезервированных средств на другие операции этим пользователем

### PUT /api/v1/get-revenue [Метод признания средств]
Параметры передаются в body:   
{  
  "time": "2020-03-21T12:00:00Z",  
  "cost": 100,  
  "order_id": 10,  
  "service_id": 3,  
  "user_id": 4  
}  

user_id - уникальный идентификатор пользователя  
cost - стоимость операции  
time - время признания в формате RFC3339  
order_id - уникальный идентификатор заказа  
service_id - уникальный идентификатор услуги  

### GET /api/v1/summary?month="month"&year="year" [Сводный отчет по пользователям]
Query-параметры:  
month - месяц для сбора отчета  
year - год для сбора отчета  

Ответ содержит в себе ссылку на сформированный CSV-файл.  

### GET /api/v1/operations?user_id="id"&page="page"&sort="sort"&direction="direction" [Метод получения списка транзакций для пользователя]
Query-параметры:  
user_id - уникальный идентификатор пользователя  
page - номер страницы. Не является обязательным - если не указать данный параметр, в ответе будут присутствовать все операции. В обратном случае, ответ будет содержать лимитированное количество транзакций (данную настройку можно изменить в конфиг-файле db_config.yaml в каталоге configs).  
sort - критерий сортировки:  
    "sum": сортировка по сумме  
    "date": сортировка по дате  
direction - направление сортировки:  
    "ASC": по возрастанию  
    "DESC": по убыванию  
Если опустить параметры сортировки, то операции будут приведены в хронологическом порядке.  
